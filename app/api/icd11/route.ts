import { NextRequest, NextResponse } from 'next/server';
  async function getToken(){ const body = new URLSearchParams({client_id: process.env.ICD11_CLIENT_ID||'', client_secret: process.env.ICD11_CLIENT_SECRET||'', scope:'icdapi_access', grant_type:'client_credentials'}); const r=await fetch('https://icdaccessmanagement.who.int/connect/token',{method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded'}, body}); if(!r.ok){return NextResponse.json({error:'ICD auth failed'}, {status:500}) as any;} return r.json(); }
  export async function GET(req: NextRequest){ const q = new URL(req.url).searchParams.get('q') || 'diabetes'; const { access_token } = await getToken(); const r = await fetch(`https://id.who.int/icd/release/11/2024-01/mms/search?q=${encodeURIComponent(q)}`, { headers:{ Authorization:`Bearer ${access_token}`, Accept:'application/json' } }); const j = await r.json(); return NextResponse.json(j); }
